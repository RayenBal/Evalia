<!-- src/app/feedback/owner-feedback-list/owner-feedback-list.component.html -->

<!-- NAVBAR MODERNE ANNONCEUR -->
<nav style="background: white; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); position: sticky; top: 0; z-index: 1000;">
  <div class="container-modern" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem;">
  <a style="text-decoration: none; cursor: pointer;" routerLink="/annonceur/home">      <img src="assets/logo-annonceur.png" alt="EVALIA Annonceur" style="height: 90px; width: auto;">
    </a>

    <ul style="display: flex; list-style: none; gap: 2rem; margin: 0; align-items: center; flex-wrap: wrap;">
      <!-- Icône de Notification -->
      <li style="position: relative;">
        <a routerLink="/annonceur/notifications" class="nav-link-modern" style="position: relative; display: inline-block;">
          <i class="bi bi-bell icon-md" style="font-size: 1.5rem;"></i>
          <!-- Badge de notification -->
          <span style="position: absolute; top: -8px; right: -8px; background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; font-weight: 700; box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);">
            3
          </span>
        </a>
      </li>
      <li><a routerLink="/profile" class="nav-link-modern"><i class="bi bi-person icon-sm"></i> Mon profil</a></li>
      <li *ngIf="!auth.isPaneliste">
        <a routerLink="/reclamations/new" class="nav-link-modern" routerLinkActive="active">
          <i class="bi bi-file-earmark-text icon-sm"></i> Ajouter une réclamation
        </a>

      <li><a routerLink="/reclamations" class="nav-link-modern"><i class="bi bi-clipboard-check icon-sm"></i> Mes Réclamations</a></li>
      <li><a routerLink="/announces" class="nav-link-modern"><i class="bi bi-megaphone icon-sm"></i> Les Annonces</a></li>

      <li *ngIf="selectedId"><a [routerLink]="['/owner/announces', selectedId, 'rewards']" class="nav-link-modern"><i class="bi bi-gift icon-sm"></i> Récompenses</a></li>
    </ul>

    <button class="btn-modern btn-danger-pastel" (click)="logout()">
      <i class="bi bi-box-arrow-right icon-sm"></i> Déconnexion
    </button>
  </div>
</nav>

<div class="container-modern" style="padding: 2rem 1rem; min-height: 100vh;">

  <!-- En-tête -->
  <div class="card-modern animate-fade-in" style="padding: 2rem; margin-bottom: 2rem;">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <div>
        <h1 class="text-gradient" style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
          <i class="bi bi-chat-left-text icon-lg"></i>
          Feedbacks de l'annonce
        </h1>
        <p style="color: #6B7280; margin: 0;">Consultez les retours de vos panélistes</p>
      </div>
      <button class="btn-modern btn-secondary-pastel" (click)="refresh()" [disabled]="loading">
        <i class="bi bi-arrow-clockwise icon-sm" [class.icon-spin]="loading"></i>
        {{ loading ? 'Chargement…' : 'Rafraîchir' }}
      </button>
    </div>
  </div>

  <!-- Erreur -->
  <div *ngIf="error" class="card-modern animate-scale-in" style="padding: 2rem; margin-bottom: 2rem; border-left: 4px solid var(--pastel-red);">
    <i class="bi bi-exclamation-triangle icon-lg" style="color: var(--pastel-red); margin-right: 0.75rem;"></i>
    <span style="color: var(--pastel-red); font-weight: 600;">{{ error }}</span>
  </div>

  <!-- Statistiques -->
  <div *ngIf="stats as s" class="card-modern animate-fade-in" style="padding: 2rem; margin-bottom: 2rem; background: linear-gradient(135deg, var(--pastel-blue-50) 0%, var(--pastel-purple-50) 100%);">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
      <div style="text-align: center;">
        <i class="bi bi-chat-dots icon-xl" style="color: var(--pastel-blue-600); display: block; margin-bottom: 0.5rem;"></i>
        <div style="font-size: 2rem; font-weight: 800; color: var(--pastel-blue-700); margin-bottom: 0.25rem;">{{ s.total }}</div>
        <div style="color: #6B7280; font-size: 0.875rem; text-transform: uppercase;">Total Feedbacks</div>
      </div>
      <div style="text-align: center;">
        <i class="bi bi-star-fill icon-xl" style="color: var(--pastel-yellow); display: block; margin-bottom: 0.5rem;"></i>
        <div style="font-size: 2rem; font-weight: 800; color: var(--pastel-blue-700); margin-bottom: 0.25rem;">{{ s.average | number: '1.1-2' }}</div>
        <div style="color: #6B7280; font-size: 0.875rem; text-transform: uppercase;">Note Moyenne</div>
      </div>
    </div>
  </div>

  <!-- Message si vide -->
  <div *ngIf="!items?.length && !error" class="card-modern animate-scale-in" style="padding: 3rem; text-align: center;">
    <i class="bi bi-inbox icon-xl" style="color: var(--pastel-blue-400); display: block; margin-bottom: 1rem;"></i>
    <p style="color: #6B7280; font-size: 1.125rem; margin: 0;">Aucun feedback pour cette annonce.</p>
  </div>

  <!-- Liste des feedbacks -->
  <div *ngIf="items?.length" class="grid-modern" style="gap: 1.5rem;">
    <div *ngFor="let f of items; let i = index; trackBy: trackById" class="card-modern animate-scale-in" [style.animation-delay]="(i * 0.1) + 's'" style="padding: 1.5rem;">
      
      <!-- En-tête du feedback -->
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <div style="display: flex; gap: 0.5rem;">
          <i *ngFor="let star of [1,2,3,4,5]" 
             class="bi" 
             [class.bi-star-fill]="star <= (f.rating || 0)" 
             [class.bi-star]="star > (f.rating || 0)"
             style="color: var(--pastel-yellow); font-size: 1.25rem;"></i>
        </div>
        <span class="badge-pastel badge-gray" style="display: flex; align-items: center; gap: 0.5rem;">
          <i class="bi bi-clock icon-sm"></i>
          {{ f.createdAt | date: 'short' }}
        </span>
      </div>

      <!-- Commentaire -->
      <div *ngIf="f.comment; else nc" style="color: #374151; line-height: 1.6; margin-bottom: 1rem; font-size: 1rem;">
        "{{ f.comment }}"
      </div>
      <ng-template #nc>
        <div style="color: #9CA3AF; font-style: italic; margin-bottom: 1rem;">
          — Aucun commentaire —
        </div>
      </ng-template>

      <!-- Info panéliste -->
      <div style="display: flex; align-items: center; gap: 0.5rem; color: #6B7280; font-size: 0.875rem;">
        <i class="bi bi-person-circle icon-sm"></i>
        <span>Panéliste #{{ f.panelistId }}</span>
        <span *ngIf="name(f)"> — {{ name(f) }}</span>
      </div>
    </div>
  </div>

  <!-- Bouton retour -->
  <button class="btn-modern btn-secondary-pastel animate-fade-in" (click)="back()" style="margin-top: 2rem;">
    <i class="bi bi-arrow-left icon-sm"></i> Retour
  </button>
</div>
