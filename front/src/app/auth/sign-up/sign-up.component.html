<!-- CONTAINER CENTRÉ -->
<div style="min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #E8F4F8 0%, #D5F5E3 100%); padding: 2rem;">

  <div class="card-modern animate-scale-in" style="max-width: 800px; width: 100%;">
    
    <!-- EN-TÊTE -->
    <div style="text-align: center; margin-bottom: 2rem;">
      <h1 class="text-gradient" style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;">
        <i class="bi bi-person-plus-fill icon-lg"></i> Créer un compte
      </h1>
      <p style="color: #757575; font-size: 1.05rem;">Rejoignez Evalia en quelques étapes</p>
    </div>

    <hr class="divider-pastel" />

    <!-- MESSAGES -->
    <div *ngIf="infoMsg" class="animate-fade-in" style="padding: 1rem; background: #B3E5FC; border-left: 4px solid #81D4FA; border-radius: 0.5rem; margin-bottom: 1.5rem; display: flex; align-items: start; gap: 0.75rem;">
      <i class="bi bi-info-circle icon-md" style="color: #0288D1;"></i>
      <div style="color: #424242;">{{ infoMsg }}</div>
    </div>

    <div *ngIf="errorMsg" class="animate-fade-in" style="padding: 1rem; background: #FFCDD2; border-left: 4px solid #EF9A9A; border-radius: 0.5rem; margin-bottom: 1.5rem; display: flex; align-items: start; gap: 0.75rem;">
      <i class="bi bi-exclamation-triangle icon-md" style="color: #D32F2F;"></i>
      <div style="color: #424242;">{{ errorMsg }}</div>
    </div>

    <!-- FORMULAIRE -->
    <form [formGroup]="form" (ngSubmit)="submit()">
      
      <!-- INFORMATIONS PERSONNELLES -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
        
        <div>
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-person" style="margin-right: 0.5rem;"></i> Prénom
          </label>
          <input class="input-modern" formControlName="firstname" placeholder="Votre prénom">
        </div>

        <div>
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-person" style="margin-right: 0.5rem;"></i> Nom
          </label>
          <input class="input-modern" formControlName="lastname" placeholder="Votre nom">
        </div>

        <div>
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-envelope" style="margin-right: 0.5rem;"></i> Email
          </label>
          <input type="email" class="input-modern" formControlName="email" placeholder="nom@exemple.com">
        </div>

        <div>
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-telephone" style="margin-right: 0.5rem;"></i> Téléphone
          </label>
          <input class="input-modern" formControlName="numTelephone" placeholder="+216 XX XXX XXX">
        </div>
      </div>

      <!-- MOTS DE PASSE -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
        
        <div>
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-lock" style="margin-right: 0.5rem;"></i> Mot de passe
          </label>
          <div style="position: relative;">
            <input
              [type]="showPw ? 'text' : 'password'"
              class="input-modern"
              formControlName="password"
              placeholder="min. 8 caractères"
              style="padding-right: 3rem;">
            <button
              type="button"
              (click)="showPw = !showPw"
              style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.25rem; color: #757575;">
              <i [class]="showPw ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
            </button>
          </div>
          <small style="color: #EF9A9A; display: block; margin-top: 0.5rem;"
                 *ngIf="form.get('password')?.touched && form.get('password')?.hasError('minlength')">
            <i class="bi bi-exclamation-circle"></i> Au moins 8 caractères
          </small>
        </div>

        <div>
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-lock-fill" style="margin-right: 0.5rem;"></i> Confirmer le mot de passe
          </label>
          <div style="position: relative;">
            <input
              [type]="showPw2 ? 'text' : 'password'"
              class="input-modern"
              formControlName="confirm"
              placeholder="Confirmer"
              style="padding-right: 3rem;">
            <button
              type="button"
              (click)="showPw2 = !showPw2"
              style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; font-size: 1.25rem; color: #757575;">
              <i [class]="showPw2 ? 'bi bi-eye-slash' : 'bi bi-eye'"></i>
            </button>
          </div>
          <small style="color: #EF9A9A; display: block; margin-top: 0.5rem;"
                 *ngIf="form.hasError('mismatch') && form.get('confirm')?.touched">
            <i class="bi bi-exclamation-circle"></i> La confirmation ne correspond pas
          </small>
        </div>
      </div>

      <!-- TYPE D'UTILISATEUR -->
      <div style="margin-bottom: 1.5rem;">
        <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.75rem;">
          <i class="bi bi-person-badge" style="margin-right: 0.5rem;"></i> Type d'utilisateur
        </label>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
          <label style="display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: #E6E6FA; border-radius: 0.75rem; cursor: pointer; transition: all 200ms; border: 2px solid transparent;"
                 [style.border-color]="form.get('typeUser')?.value === 'Paneliste' ? '#75BDD5' : 'transparent'"
                 [style.background]="form.get('typeUser')?.value === 'Paneliste' ? '#D1E9F1' : '#E6E6FA'">
            <input type="radio" formControlName="typeUser" value="Paneliste" style="width: 18px; height: 18px; cursor: pointer;">
            <div>
              <div style="font-weight: 600; color: #424242;"><i class="bi bi-flask"></i> Paneliste</div>
              <small style="color: #757575;">Participer aux tests</small>
            </div>
          </label>

          <label style="display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: #FFD6E8; border-radius: 0.75rem; cursor: pointer; transition: all 200ms; border: 2px solid transparent;"
                 [style.border-color]="form.get('typeUser')?.value === 'Announceur' ? '#75BDD5' : 'transparent'"
                 [style.background]="form.get('typeUser')?.value === 'Announceur' ? '#D1E9F1' : '#FFD6E8'">
            <input type="radio" formControlName="typeUser" value="Announceur" style="width: 18px; height: 18px; cursor: pointer;">
            <div>
              <div style="font-weight: 600; color: #424242;"><i class="bi bi-megaphone"></i> Annonceur</div>
              <small style="color: #757575;">Créer des annonces</small>
            </div>
          </label>
        </div>
      </div>

      <!-- CHAMPS CONDITIONNELS -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;">
        
        <!-- Pour Announceur -->
        <div *ngIf="form.get('typeUser')?.value === 'Announceur'" class="animate-fade-in">
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-building" style="margin-right: 0.5rem;"></i> Entreprise
          </label>
          <input class="input-modern" formControlName="companyName" placeholder="Nom de l'entreprise">
        </div>

        <!-- Pour Paneliste -->
        <div *ngIf="form.get('typeUser')?.value === 'Paneliste'" class="animate-fade-in">
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-briefcase" style="margin-right: 0.5rem;"></i> Poste
          </label>
          <input class="input-modern" formControlName="jobTitle" placeholder="Votre poste">
        </div>

        <div *ngIf="form.get('typeUser')?.value === 'Paneliste'" class="animate-fade-in">
          <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.5rem;">
            <i class="bi bi-calendar-event" style="margin-right: 0.5rem;"></i> Tranche d'âge
          </label>
          <select class="input-modern" formControlName="ageRange" style="cursor: pointer;">
            <option *ngFor="let a of ageRanges" [value]="a">{{ a }}</option>
          </select>
        </div>
      </div>
<div class="col-12" *ngIf="form.get('typeUser')?.value === 'Paneliste'">
  <label class="form-label fw-semibold">Adresse de livraison</label>
  <textarea class="form-control" rows="2"
            placeholder="Rue, ville, code postal"
            formControlName="deliveryAddress"></textarea>
  <div class="text-danger small"
       *ngIf="form.get('deliveryAddress')?.touched && form.get('deliveryAddress')?.invalid">
    Adresse requise
  </div>
  <div class="form-text">
    Utilisée pour l’envoi des produits.
  </div>
</div>
      <!-- IBAN POUR PANELISTE -->
      <div *ngIf="form.get('typeUser')?.value === 'Paneliste'" class="animate-fade-in" style="margin-bottom: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, #D5F5E3 0%, #B8ECD0 100%); border-radius: 0.75rem;">
        <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.75rem;">
          <i class="bi bi-credit-card" style="margin-right: 0.5rem;"></i> Mode de paiement (IBAN)
        </label>
        <input 
          class="input-modern" 
          formControlName="iban" 
          placeholder="TN59 1234 5678 9012 3456 7890 1234"
          style="background: white; font-family: 'Courier New', monospace; letter-spacing: 1px;">
        <small style="display: block; color: #616161; margin-top: 0.5rem;">
          <i class="bi bi-info-circle"></i> Votre IBAN pour recevoir vos récompenses en argent
        </small>
         <div class="text-danger"
       *ngIf="form.get('iban')?.touched && form.get('iban')?.invalid">
    IBAN requis / invalide.
  </div>
      </div>

      <!-- UPLOAD REGISTRE (Pour Announceur) -->
      <div *ngIf="form.get('typeUser')?.value === 'Announceur'" class="animate-fade-in" style="margin-bottom: 1.5rem; padding: 1.5rem; background: linear-gradient(135deg, #FFDAB9 0%, #FFCCCB 100%); border-radius: 0.75rem;">
        <label style="display: block; font-weight: 600; color: #424242; margin-bottom: 0.75rem;">
          <i class="bi bi-file-earmark-pdf" style="margin-right: 0.5rem;"></i> Registre de commerce (PDF) <span style="color: #EF9A9A;">*</span>
        </label>
        <input
          type="file"
          accept="application/pdf,.pdf"
          (change)="onFileChange($event)"
          style="display: block; padding: 0.75rem; border: 2px dashed #FFB88C; border-radius: 0.5rem; background: white; cursor: pointer; width: 100%;">
        <small style="display: block; color: #616161; margin-top: 0.5rem;">
          Obligation de copie de registre de commerce
        </small>
        <small style="color: #EF9A9A; display: block; margin-top: 0.5rem;" *ngIf="fileError">
          <i class="bi bi-exclamation-circle"></i> {{ fileError }}
        </small>
      </div>

      <!-- BOUTON SOUMETTRE -->
      <div style="text-align: center; padding-top: 1rem;">
        <button
          type="button"
          class="btn-modern btn-primary-pastel"
          (click)="submit()"
          [disabled]="form.invalid || loading || (form.get('typeUser')?.value === 'Announceur' && (!registreCommerceFile || fileError))"
          [style.opacity]="form.invalid || loading || (form.get('typeUser')?.value === 'Announceur' && (!registreCommerceFile || fileError)) ? '0.6' : '1'"
          style="font-size: 1.1rem; padding: 1rem 3rem; width: 100%; max-width: 400px; justify-content: center;">
          <span *ngIf="loading" class="spinner-pastel" style="width: 18px; height: 18px; border-width: 2px; margin-right: 0.5rem;"></span>
          <i class="bi bi-check-circle" *ngIf="!loading" style="margin-right: 0.5rem;"></i>
          {{ loading ? 'Inscription...' : 'Créer le compte' }}
        </button>
      </div>
    </form>

    <!-- LIEN CONNEXION -->
    <hr class="divider-pastel" style="margin: 2rem 0;">
    
    <p style="text-align: center; margin: 0; color: #616161;">
      Déjà inscrit ? 
      <a routerLink="/login" style="color: #47A7C7; text-decoration: none; font-weight: 600; margin-left: 0.25rem;">
        Se connecter
      </a>
    </p>
  </div>
</div>
